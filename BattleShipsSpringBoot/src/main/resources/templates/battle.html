<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Bitwa!</title>
<style>
	img{
	margin: 0px;
	padding: 0px;
	height: 30px;
	width: 30px;
	}
	td{
	text-align: center;
	margin: 0px;
	padding: 0px;
	height: 30px;
	width: 30px;
	}
	#response {
		width: 500px;
		height: 100px;
		overflow-y: scroll;
		overflow-x: auto;
	}
	.battlefield {
		display: inline-block;
		border: solid black 1px;
		background-color: navy;
		color: white;
	}
	.field {
		width: 100%;
		height: 100%;
		padding: 0px;
		margin: 0px;
		background-color: white;
	}
	#myMap{
		display: inline-block;
	}
	#enemyMap{
		display: inline-block;
	}
</style>
</head>
<body >
        <div id="conteiner">
        <div id="myMap" class="battlefield">
        	<p>plansza</p>
        </div>
        <div id="enemyMap" class="battlefield">
        	<p>plansza</p>
        </div>
            <br />
            
            <br />
            
            <div id="conversationDiv">
            	<input type="text" id="from" th:value="${session.name}"></input>
            	<p>Globalny czat</p>
                <div id="chat">
                <p id="response"></p>
                <input style="min-width:250px" type="text" id="text" placeholder="Napisz coÅ› do innych graczy..."/>
                <button id="sendMessage" onclick="sendMessage();">Send</button>
                </div>
                
                
            </div>
        </div>
        <script src="/webjars/sockjs-client/sockjs.min.js"></script>
		<script src="/webjars/stomp-websocket/stomp.min.js"></script>
        <script th:inline="javascript">
        /*<![CDATA[*/
        var stompClient = null;
        
        var link = [[${session.gameName}]];

        var socket = new SockJS('/chat');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function(frame) {
        	console.log('Connected: ' + frame);
        	stompClient.subscribe('/topic', function(messageOutput) {
        		showMessageOutput(JSON.parse(messageOutput.body));
        	});
        });

        document.getElementById('from').style.visibility = 'hidden';

        function sendMessage() {
        	var from = document.getElementById('from').value;
        	var text = document.getElementById('text').value;
        	stompClient.send("/app/chat", {}, JSON.stringify({
        		'fromPlayer' : from,
        		'message' : text
        	}));
        	
        	
        }

        function showMessageOutput(messageOutput) {
        	var response = document.getElementById('response');
        	console.log(messageOutput.fromPlayer + ": "
        			+ messageOutput.message);
        	var p = document.createElement('p');
        	p.appendChild(document.createTextNode(messageOutput.fromPlayer + ": "
        			+ messageOutput.message));
        	response.appendChild(p);
        	document.getElementById('response').scrollTop=1e6;
        	document.getElementById('text').value = "";
        }
  
        function buildMyMap(){
        	
        	var generate = "<table><tr><td></td><td>A</td><td>B</td><td>C</td><td>D</td><td>E</td><td>F</td><td>G</td><td>H</td><td>I</td><td>J</td>";
            
            var numOfRow = 1;
            
            var letters = "ABCDEFGHIJ";
            
            var letter;
            
            var i;
            
            var nextNumberOfField
            for (var j=1;j<11;j++){
            	
            	nextNumberOfField = j;
            	
            	for (i=0;i<12;i++){
            		
            		letter = letters.charAt(i-2);
                	
                	if(i==0){
                		generate += "</tr><tr>";
                	} else if(i==1){
                		generate += "<td>"+numOfRow+"</td>";
                		
                	} else {
                		generate += "<td><input type=\"button\" value=\""+letter+nextNumberOfField+"\" class=\"field\" id=\"Y"+letter+nextNumberOfField+"\" /></td>";
                	}
                	
                }
            	numOfRow++;
            }
            generate+="</tr></table>";
            
            document.getElementById("myMap").innerHTML=generate;
        }
        
		function buildEnemyMap(){
        	
        	var generate = "<table><tr><td></td><td>A</td><td>B</td><td>C</td><td>D</td><td>E</td><td>F</td><td>G</td><td>H</td><td>I</td><td>J</td>";
            
            var numOfRow = 1;
            
            var letters = "ABCDEFGHIJ";
            
            var letter;
            
            var i;
            
            var nextNumberOfField
            for (var j=1;j<11;j++){
            	
            	nextNumberOfField = j;
            	
            	for (i=0;i<12;i++){
            		
            		letter = letters.charAt(i-2);
                	
                	if(i==0){
                		generate += "</tr><tr>";
                	} else if(i==1){
                		generate += "<td>"+numOfRow+"</td>";
                		
                	} else {
                		generate += "<td><div class=\"field\" id=\"M"+letter+nextNumberOfField+"\"></div></td>";
                	}
                	
                }
            	numOfRow++;
            }
            generate+="</tr></table>";
            
            document.getElementById("enemyMap").innerHTML=generate;
        }
		
		function putMyShips(){
			
			for(var i=0;i<[[${session.ships}]].length;i++){
				document.getElementById("M"+[[${session.ships}]][i].location).innerHTML="<img src=\"/statek3.jpg\" alt=\"X\" >";
			}
			
		}
        
        buildMyMap();
   
        buildEnemyMap();
        
        putMyShips();
        /*]]>*/
        </script>
</body>
</html>